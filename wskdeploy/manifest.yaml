# Manifest for refarch-template
# Repo is located at https://github.com/IBM/ibm-cloud-functions-refarch-template
# Installing OpenWhisk actions, triggers, and rules for sample app

# Deployment using this manifest file creates following OpenWhisk components:
#   Package:    refarch-template
#   Action:     refarch-template/message-consume
#   Action:     refarch-template/message-produce
#   Sequence:   refarch-template/message-processing-sequence
#   Trigger:    message-trigger
#   Rule:       message-rule

# This manifest file expects following env. variables:
#   SERVICE_HOSTNAME=value
#   SERVICE_USERNAME=value
#   SERVICE_PASSWORD=value
#   SERVICE_DATABASE=value
packages:
    refarch-template:
        actions:
            # Action named "message-consume"
            # Creating action as a regular Node.js action
            message-consume:
                function: actions/message-consume.js
            # Action named "message-produce"
            message-produce:
                function: actions/message-produce.js
                inputs:
                    hostname: $SERVICE_HOSTNAME
                    database: $SERVICE_DATABASE
        sequences:
            # Sequence named "message-processing-sequence"
            # Creating the sequence that links the get and post actions
            message-processing-sequence:
                actions: message-consume, message-produce
        triggers:
            # Creating the message-trigger trigger"
            message-trigger:
                feed: Bluemix_${SERVICE_HOSTNAME}_Credentials-1/arbitraryFeed
                inputs:
                    isJSONData: true
                    hostname: $SERVICE_HOSTNAME
        rules:
            # Rule named "message-rule"
            # Creating the rule that links the trigger to the sequence
            message-rule:
                trigger: message-trigger
                action: message-processing-sequence
